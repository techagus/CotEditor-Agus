<html lang="es">

<head>
	<meta charset="UTF-8"/>
	<meta name="keywords" content="Menú de scripts, guiones, scripts, paquete de scripts, guiones, gancho"/>
	<link rel="stylesheet" href="../../Shared/sty/standard.css"/>
	<link rel="stylesheet" href="../../Shared/sty/pygmentize.css"/>
	<script defer src="../../Shared/js/toc.js"></script>
	
	<title>Añadir ganchos de scripting a los scripts de CotEditor</title>
</head>

<body>

<h1>Añadir ganchos de scripting a los scripts de CotEditor</h1>

<p>Los ganchos de scripting permiten que los scripts de CotEditor se ejecuten con ciertos eventos. Los siguientes eventos están disponibles en CotEditor:</p>

<ul>
	<li><code>document opened</code> : después de abrir el archivo y cargar su contenido</li>
	<li><code>document saved</code> : después de guardar el archivo y almacenar su contenido</li>
</ul>

<p>Consulte la sección "CotEditor Event Handler suite" en el Diccionario AppleScript para obtener más información.</p>

<p>El resto de esta página describe cómo incluir el gancho del script que se conecta a tu script de CotEditor.</p>

<h2>Sinopsis</h2>

<p>Los scripts con gancho de scripting deben ajustarse a los siguientes protocolos:</p>

<ul>
	<li>escrito en AppleScript o JavaScript para la automatización (JXA)</li>
	<li>almacenado en forma de un paquete de scripts (`.scptd`)</li>
</ul>

<p>Además, se deben declarar los eventos a los que suscribirse y los controladores para ellos, como se describe a continuación.</p>

<h2>Estructura del paquete de scripts</h2>

<p>Un paquete de scripts tiene la siguiente estructura de directorios:</p>

<pre>
HookingScript.scptd
└── Contents
    ├── Info.plist
    └── Resources
        ├── Script Libraries
        │   └── my-fancy-library.scpt
        ├── Scripts
        │   └── main.scpt
        └── description.rtfd
            └── TXT.rtf
</pre>

<p>Cualquier script se puede exportar en este formulario con Script Editor.app, que es una de las aplicaciones estándar distribuidas con macOS.</p>

<p>Para admitir los ganchos de scripting, la lista de eventos para suscribirse debe escribirse en `Contents/Info.plist`. `Info.plist` es una lista de propiedades que contiene los metadatos del paquete y está formateada en XML como en el siguiente ejemplo:</p>

<pre class="highlight source"><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>CFBundleIdentifier<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>com.coteditor.hooking-script<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>CFBundleName<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>Hooking Script<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>CFBundleShortVersionString<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>1.0<span class="nt">&lt;/string&gt;</span>
  <span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</pre>

<p>Los eventos a los que suscribirse deben almacenarse en la clave `CotEditorHandlers` y en forma de `array` de `string`.</p>

<pre class="highlight source"><span></span><span class="nt">&lt;key&gt;</span>CotEditorHandlers<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;array&gt;</span>
  <span class="nt">&lt;string&gt;</span>document opened<span class="nt">&lt;/string&gt;</span>
  <span class="nt">&lt;string&gt;</span>document saved<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/array&gt;</span>
</pre>

<h2>Manipuladores de eventos</h2>

<p>Un controlador de eventos es un bloque para recibir ciertos eventos que la aplicación causó y hacer algo con el evento recibido. En esta sección, las formas de escribir un controlador de eventos se describen con un ejemplo simple, que muestra el cuadro de diálogo para abrir y guardar un archivo.</p>

<h3>AppleScript</h3>

<p>En AppleScript, los controladores se escriben con bloques `using terms from` y `on`.</p>

<pre class="highlight source"><span></span><span class="k">using terms from</span> <span class="nb">application</span> <span class="s2">&quot;CotEditor&quot;</span>
    <span class="nb">on</span> <span class="na">document</span> <span class="nv">opened</span> <span class="nv">theDocument</span>
        <span class="k">set</span> <span class="nv">title</span> <span class="k">to</span> <span class="nv">name</span> <span class="k">of</span> <span class="nv">theDocument</span>
        <span class="nb">display alert</span> <span class="s2">&quot;Opened &quot;</span> <span class="o">&amp;</span> <span class="nv">title</span>
    <span class="k">end</span> <span class="na">document</span> <span class="nv">opened</span>

    <span class="nb">on</span> <span class="na">document</span> <span class="nv">saved</span> <span class="nv">theDocument</span>
        <span class="k">set</span> <span class="nv">title</span> <span class="k">to</span> <span class="nv">name</span> <span class="k">of</span> <span class="nv">theDocument</span>
        <span class="nb">display alert</span> <span class="s2">&quot;Saved &quot;</span> <span class="o">&amp;</span> <span class="nv">title</span>
    <span class="k">end</span> <span class="na">document</span> <span class="nv">saved</span>
<span class="k">end</span> <span class="k">using terms from</span>
</pre>

<h3>JavaScript para Automatización (JXA)</h3>

<p>En JXA, las declaraciones `function` en el objeto global crearán manejadores.</p>

<pre class="highlight source"><span></span><span class="nx">CotEditor</span> <span class="o">=</span> <span class="nx">Application</span><span class="p">.</span><span class="nx">currentApplication</span><span class="p">()</span>
<span class="nx">CotEditor</span><span class="p">.</span><span class="nx">includeStandardAdditions</span> <span class="o">=</span> <span class="kc">true</span>

<span class="kd">function</span> <span class="nx">documentOpened</span><span class="p">(</span><span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">CotEditor</span><span class="p">.</span><span class="nx">displayAlert</span><span class="p">(</span><span class="s2">&quot;Opened &quot;</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">name</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">documentSaved</span><span class="p">(</span><span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">CotEditor</span><span class="p">.</span><span class="nx">displayAlert</span><span class="p">(</span><span class="s2">&quot;Saved &quot;</span> <span class="o">+</span> <span class="nb">document</span><span class="p">.</span><span class="nx">name</span><span class="p">())</span>
<span class="p">}</span>
</pre>

<section id="cf">
<h2>Ver también</h2>
<ul>
	<li><a href="script_overview.html">Script CotEditor</a></li>
	<li><a href="script_menu.html">Personaliza el menú Script</a></li>
	<li><a href="script_osascript.html">Script CotEditor con AppleScript</a></li>
</ul>
</section>

</body>
</html>
